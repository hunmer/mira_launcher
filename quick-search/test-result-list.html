<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResultList组件测试</title>
    
    <!-- PrimeVue CSS -->
    <link rel="stylesheet" href="https://unpkg.com/primevue@^4/resources/themes/aura-light-green/theme.css">
    <link rel="stylesheet" href="https://unpkg.com/primevue@^4/resources/primevue.min.css">
    <link rel="stylesheet" href="https://unpkg.com/primeicons@^7/primeicons.css">
    <link rel="stylesheet" href="https://unpkg.com/primeflex@^3/primeflex.css">
    
    <!-- 组件样式 -->
    <link rel="stylesheet" href="components/ResultList.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
            background: var(--surface-ground, #f8f9fa);
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .test-controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
        }
        .control-group {
            margin-bottom: 10px;
        }
        .control-group label {
            display: inline-block;
            width: 120px;
            font-weight: 500;
        }
        .control-group input, .control-group select {
            padding: 5px 10px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin-right: 10px;
        }
        .test-info {
            margin: 20px 0;
            padding: 15px;
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
        }
        .event-log {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-item {
            padding: 5px 0;
            border-bottom: 1px solid #e5e5e5;
            font-size: 14px;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="test-container">
            <h1>ResultList 组件测试</h1>
            
            <div class="test-controls">
                <div class="control-group">
                    <label>搜索查询:</label>
                    <input v-model="searchQuery" type="text" placeholder="输入搜索关键词..." @input="updateResults">
                </div>
                <div class="control-group">
                    <label>选中索引:</label>
                    <input v-model.number="selectedIndex" type="number" min="-1" :max="testResults.length - 1">
                    <button @click="selectedIndex = -1">清除选中</button>
                </div>
                <div class="control-group">
                    <label>显示评分:</label>
                    <input v-model="showScore" type="checkbox">
                    <label>加载状态:</label>
                    <input v-model="loading" type="checkbox">
                </div>
                <div class="control-group">
                    <label>空状态类型:</label>
                    <select v-model="emptyStateType">
                        <option value="search">搜索提示</option>
                        <option value="noResults">无结果</option>
                    </select>
                </div>
            </div>
            
            <div class="test-info">
                <h3>测试功能:</h3>
                <ul>
                    <li>✅ 不同类型结果展示 (应用、页面、插件、文件)</li>
                    <li>✅ 选中状态高亮和鼠标悬停效果</li>
                    <li>✅ 搜索关键词高亮显示</li>
                    <li>✅ 图标展示和错误处理</li>
                    <li>✅ 响应式设计和无障碍支持</li>
                </ul>
            </div>
            
            <!-- ResultList组件测试 -->
            <div style="height: 500px; border: 1px solid #d1d5db; border-radius: 8px; overflow: hidden;">
                <result-list
                    :results="filteredResults"
                    :selected-index="selectedIndex"
                    :search-query="searchQuery"
                    :loading="loading"
                    :empty-state="currentEmptyState"
                    :show-score="showScore"
                    :max-visible-items="10"
                    @select="handleSelect"
                    @selected-index-change="handleSelectedIndexChange"
                    @mouse-enter="handleMouseEnter"
                    @mouse-leave="handleMouseLeave"
                />
            </div>
            
            <div class="event-log">
                <h4>事件日志:</h4>
                <div
                    v-for="(log, index) in eventLogs"
                    :key="index"
                    class="log-item"
                >
                    {{ log }}
                </div>
            </div>
        </div>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- PrimeVue CDN -->
    <script src="https://unpkg.com/primevue@^4/umd/primevue.min.js"></script>
    <!-- ResultList组件 -->
    <script src="components/ResultList.js"></script>

    <script>
        const { createApp, ref, computed } = Vue

        const TestApp = {
            setup() {
                const eventLogs = ref([])
                const searchQuery = ref('')
                const selectedIndex = ref(-1)
                const showScore = ref(true)
                const loading = ref(false)
                const emptyStateType = ref('search')
                
                // 测试数据
                const testResults = ref([
                    {
                        id: '1',
                        name: 'Visual Studio Code',
                        title: 'Visual Studio Code',
                        description: '强大的代码编辑器',
                        category: '开发工具',
                        type: 'app',
                        icon: '/public/icons/vscode.svg',
                        score: 95,
                        version: '1.85.0'
                    },
                    {
                        id: '2',
                        name: 'Chrome Browser',
                        title: 'Chrome Browser',
                        description: 'Google Chrome 网页浏览器',
                        category: '网络浏览',
                        type: 'app',
                        icon: '/public/icons/chrome.svg',
                        score: 88,
                        version: '120.0'
                    },
                    {
                        id: '3',
                        name: '设置页面',
                        title: '设置页面',
                        description: '应用程序设置和配置',
                        category: '系统设置',
                        type: 'page',
                        score: 76
                    },
                    {
                        id: '4',
                        name: '文件管理插件',
                        title: '文件管理插件',
                        description: '增强的文件管理功能',
                        category: '系统工具',
                        type: 'plugin',
                        score: 82,
                        version: '2.1.0'
                    },
                    {
                        id: '5',
                        name: 'README.md',
                        title: 'README.md',
                        description: '项目说明文档',
                        category: '文档',
                        type: 'file',
                        score: 67
                    },
                    {
                        id: '6',
                        name: 'Spotify',
                        title: 'Spotify',
                        description: '音乐流媒体应用',
                        category: '娱乐',
                        type: 'app',
                        icon: '/public/icons/spotify.svg',
                        score: 91,
                        version: '1.2.25'
                    }
                ])

                const addLog = (message) => {
                    const timestamp = new Date().toLocaleTimeString()
                    eventLogs.value.unshift(`[${timestamp}] ${message}`)
                    // 保持最多20条日志
                    if (eventLogs.value.length > 20) {
                        eventLogs.value = eventLogs.value.slice(0, 20)
                    }
                }

                // 过滤结果
                const filteredResults = computed(() => {
                    if (!searchQuery.value.trim()) {
                        return testResults.value
                    }
                    
                    return testResults.value.filter(item => 
                        item.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                        item.description.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                        item.category.toLowerCase().includes(searchQuery.value.toLowerCase())
                    )
                })

                // 当前空状态
                const currentEmptyState = computed(() => {
                    if (emptyStateType.value === 'search') {
                        return {
                            icon: 'pi pi-search',
                            iconColor: '#6b7280',
                            title: '开始输入以搜索',
                            subtitle: '搜索应用程序、文件或功能'
                        }
                    } else {
                        return {
                            icon: 'pi pi-exclamation-circle',
                            iconColor: '#f59e0b',
                            title: '未找到匹配的结果',
                            subtitle: '尝试使用不同的关键词'
                        }
                    }
                })

                const updateResults = () => {
                    addLog(`🔍 搜索更新: "${searchQuery.value}" (${filteredResults.value.length} 个结果)`)
                }

                const handleSelect = ({ item, index }) => {
                    addLog(`✅ 选择结果: ${item.name} (索引: ${index})`)
                }

                const handleSelectedIndexChange = (newIndex) => {
                    selectedIndex.value = newIndex
                    addLog(`📍 选中索引变更: ${newIndex}`)
                }

                const handleMouseEnter = ({ index, item }) => {
                    addLog(`🖱️ 鼠标悬停: ${item.name} (索引: ${index})`)
                }

                const handleMouseLeave = () => {
                    addLog(`🖱️ 鼠标离开`)
                }

                return {
                    eventLogs,
                    searchQuery,
                    selectedIndex,
                    showScore,
                    loading,
                    emptyStateType,
                    testResults,
                    filteredResults,
                    currentEmptyState,
                    updateResults,
                    handleSelect,
                    handleSelectedIndexChange,
                    handleMouseEnter,
                    handleMouseLeave
                }
            }
        }

        const app = createApp(TestApp)
        app.component('ResultList', ResultList)
        app.mount('#app')
    </script>
</body>
</html>
